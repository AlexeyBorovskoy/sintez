# Передача инженеру (комплект `handoff`)

Эта папка содержит **самодостаточный комплект** для стороннего специалиста, который будет тестировать и разворачивать решение на реальном МФУ под OpenWrt.

Цель: МФУ работает “прокладкой” между АСУДД «СПЕКТР» (Spectr-ITS) и контроллером «Синтез» (UTMC/SNMP), заменяя логику “ноды/плагина” на стороне АСУДД.

## Что внутри

- `mfu_bridge/` основной комплект (код, конфиги, каркас OpenWrt-пакета, инструменты диагностики).

Если передаете инженеру только одну папку, передавайте **`handoff/mfu_bridge/`**.

## Предполагаемая схема подключения

- АСУДД «СПЕКТР» имеет сервер Spectr (ITS/commserver), который принимает TCP-подключение от “устройств”.
- МФУ запускает сервис `spectr-utmc-bridge`, который **как клиент** подключается к `its.host:its.port`.
- МФУ управляет контроллером «Синтез» по UTMC/SNMP (UDP/161).

Сетевые настройки МФУ (интерфейсы/маршруты/NAT/firewall) в этот комплект не включены и должны настраиваться отдельно, чтобы не конфликтовать с другими пакетами на МФУ.

## С чего начать инженеру

1. Открыть `handoff/mfu_bridge/README.md`.
2. Определить целевую платформу МФУ (версия OpenWrt, target/архитектура).
3. Собрать `.ipk` в OpenWrt SDK (в комплекте есть локальные исходники для сборки без интернета).
4. Установить `.ipk` на МФУ, настроить `/etc/spectr-utmc/config.json`, запустить сервис через `procd`.
5. Провести функциональные тесты и собрать логи.

## Куда смотреть дальше

- Инструкция по комплекту: `handoff/mfu_bridge/README.md`
- Чеклист тестирования: `handoff/mfu_bridge/CHECKLIST.md`
- Каркас OpenWrt-пакета: `handoff/mfu_bridge/openwrt/README.md`
- Поиск логики “ноды” в установленной АСУДД (RoadCenter/Spectr): `handoff/mfu_bridge/docs/ASUDD_NODE_DISCOVERY.md`
- Примеры отчетов/логов со стенда: `handoff/mfu_bridge/examples/`

## Примечания по конфигурации и секретам

В тестовом контуре допускается хранение паролей “как есть”, но для эксплуатации рекомендуется:

- не хранить пароли в git;
- хранить секреты отдельными файлами с правами `600` (доступ только для `root`) и передавать в сервис через пути к файлам;
- по возможности использовать SSH-ключи вместо пароля.

## Как фиксировать результаты испытаний

Для разбора проблем важны:

- версия прошивки МФУ и target/arch;
- топология сети (какой интерфейс МФУ смотрит в сторону АСУДД, какой в сторону контроллера);
- текущий `config.json` (без секретов или с замаскированными значениями);
- `logread` (логи `procd` сервиса) и журналы с контроллера;
- сценарий действий: какие команды отправлялись из АСУДД и что было видно “на объекте”.
