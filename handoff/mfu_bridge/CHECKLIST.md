# Чеклист тестирования на МФУ

## Перед началом (проверка готовности)

- Прошивка МФУ соответствует таргету OpenWrt, под который собран пакет (19.07.x, `ramips/mt7620`, `mipsel_24kc`).
- Маршрутизация/доступность:
  - МФУ -> сервер Spectr на стороне АСУДД доступен (`its.host:its.port`, TCP).
  - МФУ -> контроллер доступен по SNMP (UDP/161).
- Понимание таймаутов/ретраев: SNMP в реальных сетях может терять пакеты.

## Установка

- `opkg install /tmp/spectr-utmc-bridge_*.ipk`
- Конфиг на месте: `/etc/spectr-utmc/config.json`
- Сервис включен и запущен:
  - `/etc/init.d/spectr-utmc-bridge enable`
  - `/etc/init.d/spectr-utmc-bridge start`
- Просмотр логов: `logread -f`

## Функциональные тесты

- `GET_STAT` отвечает `>O.K.` (и полезная нагрузка STAT выглядит консистентно).
- `GET_REFER` отвечает `>O.K.`
- `SET_PHASE <n>` отвечает `>O.K.` и контроллер меняет фазу.
- `SET_YF` отвечает `>O.K.`, и при этом:
  - визуально включается ЖМ,
  - `utcReplyFR` становится ненулевым,
  - ЖМ удерживается за счет keepalive (`utcControlFF=1` переотправляется периодически).
- Останов ЖМ другой “режимной” командой:
  - `SET_LOCAL` (предпочтительно) или `SET_OS`,
  - проверить, что keepalive остановился и состояние контроллера поменялось ожидаемо.

## Стабильность

- Рестарт сервиса:
  - `/etc/init.d/spectr-utmc-bridge restart`
  - проверить переподключение к ITS-серверу и продолжение работы.
- Сетевые обрывы:
  - имитировать отключение/подключение сети ITS,
  - убедиться, что автопереподключение работает (нет падений, нет бесконечного цикла с нагрузкой на CPU).
