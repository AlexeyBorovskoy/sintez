# Полный аудит контроллера (read-only)

Дата аудита: 11 февраля 2026  
Объект: контроллер `192.168.75.150`  
Хост: `sintez-lite-3b`

## 1. Цель и ограничения

Цель: получить полный технический срез работы контроллера без риска нарушения работы.  
Ограничения: использовались только read-only операции:

- SSH-команды чтения (`status`, `journalctl`, `cat`, `ls`, `ps`, `ss`, `df`, `free`).
- SNMP `GET` без `SET`.
- Без перезапусков сервисов.
- Без изменения конфигов.

## 2. Доступ и права

- SSH доступ подтвержден: `voicelink@192.168.75.150`.
- `sudo` доступ подтвержден (через пароль), root-права доступны.
- Прямой root-login не использовался.

## 3. Системная информация

- ОС: Linux `5.10.63-v7+` (armv7l, Raspberry Pi platform).
- Uptime на момент проверки: около 30 дней.
- Пользовательская сессия: `voicelink`.

### Ресурсы

- Диск `/`: 55% занято (`7.1G`, свободно `3.1G`).
- RAM: `972Mi`, использовано ~`477Mi`, доступно ~`396Mi`.
- Температура: ~`53.2°C`.

## 4. Ключевые процессы

По загрузке CPU:

- `resident` (PID 357) ~`88.7%`.
- `snmp_agent` (PID 463) ~`82.8%`.
- дополнительные worker-процессы `resident` также потребляют CPU.
- `node` (`spectr_utmc.js`) активен, память около `28.7%`.

Вывод: система работает стабильно, но CPU-нагрузка высокая и постоянная.

## 5. Сервисы (systemd)

В состоянии `running`:

- `resident.service`
- `snmp_agent.service`
- `snmpd.service`
- `spectr_utmc.service`
- `nginx.service`
- `web_admin.service`
- `web_detect.service`
- `modbus_tcp.service`
- `traffixtream2.service`
- `traficam.service`

Ключевой мост:

- `spectr_utmc.service`
- `WorkingDirectory=/home/voicelink/scripts/spectr_utmc`
- `ExecStart=/usr/bin/node spectr_utmc.js config.json`

## 6. Сетевые интерфейсы и порты

Интерфейсы:

- `eth0`: `192.168.75.150/24`
- `wlan0`: `DOWN`

Слушающие порты:

- `22/tcp` (SSH)
- `80/tcp` (HTTP)
- `443/tcp` (HTTPS)
- `161/udp` (SNMP)
- `10162/udp` (SNMP trap path)
- `502/tcp` (Modbus TCP)

## 7. Конфигурация контроллера

Считанный файл:

- `/home/voicelink/rtc/resident/config`
- локальная копия: `/home/alexey/shared_vm/spectr_utmc/controller_config.json`

Ключевые поля:

- `"mode": "local"`
- `"remote_onoff": false`
- `"deny_rcp": false`
- `programm` присутствует (фазы/планы/расписание).

Планы:

- `plans["1"]`: основной ("По умолчанию"), содержит действия фаз.
- `plans["2"]`: "Выходные".

## 8. SNMP runtime-состояние (GET-only)

Проверка выполнялась через `test_controller` (локально `snmpget` не установлен).

OID и значения:

- `1.3.6.1.4.1.13267.3.2.4.1` (`utcType2OperationMode`) = `INTEGER: 1`
- `1.3.6.1.4.1.13267.3.2.5.1.1.3` (`utcReplyGn`) = `Hex-STRING` (фаза меняется по циклу)
- `1.3.6.1.4.1.13267.3.2.5.1.1.5` = `INTEGER: 0`
- `1.3.6.1.4.1.13267.3.2.5.1.1.36` (`utcReplyFR`) = `INTEGER: 0`
- `1.3.6.1.4.1.13267.3.2.5.1.1.45` = `INTEGER: 0`
- `1.3.6.1.4.1.13267.3.2.5.1.1.4` = `No Such Object`

Наблюдение в динамике:

- `utcReplyGn` меняется (`08`, `10`, ...), фазы переключаются штатно.
- `utcReplyFR` остается `0`, признак активного желтого мигания отсутствует.
- Режим остается `OperationMode=1` (локальный).

## 9. Логи и поведение

`spectr_utmc` журнал:

- регулярные `EVENT` по фазам.
- периодические `GET_REFER/REFER`.
- обмен с ITS активен.

`resident` журнал:

- после перезапуска контроллер выбирает Program/Plan:
- `Program №1 (fixed mode) is selected`
- `Plan №1 is started`
- `_program schedmode = 1`

Критичный диагностический маркер из `info.log`:

- `Deny the remote controll in case of amber flash error: True`

Примечание: это runtime-сообщение сервиса, и оно важно при диагностике удаленного управления и ЖМ.

## 10. Почему не активируется ЖМ (по текущему срезу)

На момент аудита:

- контроллер в локальном режиме (`OperationMode=1`);
- в конфиге `mode=local` и `remote_onoff=false`;
- `utcReplyFR=0`.

Технический вывод:

- удаленное воздействие на ЖМ может быть ограничено текущим режимом и внутренними защитами;
- проблема не связана с отказом SNMP-чтения или падением сервисов, так как чтение и цикл фаз работают.

## 11. Риски

- Высокая постоянная CPU-нагрузка `resident`/`snmp_agent` снижает запас по производительности.
- При диагностике ЖМ любые активные `SET`/смена режима нужно делать только в контролируемом окне теста.

## 12. Рекомендованный следующий шаг (безопасный)

Сделать отдельный управляемый тест-кейс из 3 стадий с полной записью:

1. Базовый срез (`GET` OID + журналы) в локальном режиме.
2. Переход в удаленный режим штатным способом (через web/ASUDD, не через "сырой" SET).
3. Повторный срез и проверка ЖМ по `utcReplyFR` + визуально.

Это даст доказуемое сравнение "до/после" без несанкционированного вмешательства.
