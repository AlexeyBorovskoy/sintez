# Сводка результатов тестирования жёлтого мигания

**Дата:** 2026-02-04  
**Контроллер:** 192.168.75.150  
**Community:** UTMC

## Результаты тестов

### Тест 1: Удержание команды (60 секунд)
- **Статус:** Все SNMP команды успешны
- **Результат:** Визуально мигание НЕ активировалось
- **utcReplyFR:** остался 0

### Тест 2: Точное повторение Node.js логики
- **Статус:** Все SNMP команды успешны
- **Результат:** Визуально мигание НЕ активировалось
- **utcReplyFR:** остался 0

## Наблюдения

### Что работает:
1. ✅ SNMP SET операции выполняются успешно
2. ✅ Контроллер принимает команды
3. ✅ Перевод в режим UTC Control работает
4. ✅ Установка фазы работает
5. ✅ Команда SET_YF отправляется без ошибок

### Что не работает:
1. ❌ Визуальная активация жёлтого мигания
2. ❌ utcReplyFR не меняется на 1
3. ❌ Контроллер не переходит в режим мигания

## Анализ оригинального Node.js кода

### Реализация SET_YF:
```javascript
SET_YF(e){
    return this.set(e,[
        {oid:l.utcType2OperationMode,type:u,value:3},
        {oid:l.utcControlFF,type:u,value:1}
    ])
}
```

**Ключевые особенности:**
- Однократная отправка команды (без удержания)
- Два varbind в одной SNMP SET операции
- Нет предварительных проверок
- Нет ожидания условий

## Возможные причины проблемы

### 1. Контроллер требует дополнительных условий
Согласно документации, для SetAF требуются:
- Команда активна минимум 10 секунд ✅ (выполнено в тесте 1)
- "nominated stage" (определённая фаза) ❓ (неизвестно, какая именно)
- Истёкшие минимальные периоды работы фаз ❓ (неизвестны точные значения)

### 2. Контроллер работает в другом режиме/конфигурации
- В реальной АСУДД системе контроллер может быть постоянно в режиме UTC Control
- Может быть настроена другая конфигурация фаз
- Может быть включены другие параметры

### 3. Контроллер требует определённой последовательности команд
- Возможно, нужно сначала установить фазу, затем дождаться её активации
- Возможно, нужно дождаться истечения минимальных периодов
- Возможно, нужна комбинация других команд

### 4. Проблема с контроллером или его конфигурацией
- Контроллер может быть в тестовом режиме
- Контроллер может иметь ограничения на активацию мигания
- Контроллер может требовать дополнительной авторизации или настроек

## Рекомендации

### Следующие шаги:
1. **Проверить работу оригинального Node.js кода** на этом контроллере
   - Запустить оригинальный `spectr_utmc.js` на контроллере
   - Отправить команду SET_YF через АСУДД систему
   - Проверить, активируется ли мигание

2. **Проверить конфигурацию контроллера**
   - Изучить конфигурационные файлы контроллера
   - Проверить настройки фаз и режимов работы
   - Проверить ограничения на активацию мигания

3. **Попробовать другие последовательности команд**
   - SET_PHASE → ожидание → SET_YF
   - SET_PHASE на разные фазы → SET_YF
   - Комбинация с другими командами

4. **Проверить документацию контроллера**
   - Точные требования для SetAF
   - Значения минимальных периодов работы фаз
   - Определение "nominated stage"

5. **Связаться с производителем контроллера**
   - Уточнить требования для активации мигания
   - Проверить, нет ли известных проблем
   - Получить рекомендации по настройке

## Выводы

Все SNMP команды выполняются успешно, но визуальная активация мигания не происходит. Это указывает на то, что проблема не в формате команд или их отправке, а в условиях, которые контроллер требует для активации мигания.

Необходимо проверить работу оригинального Node.js кода на этом контроллере, чтобы понять, работает ли вообще активация мигания в текущей конфигурации.
