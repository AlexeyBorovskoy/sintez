# Этап 7: Интеграционное тестирование с полным приложением

**Дата:** 2026-02-03  
**Цель:** Тестирование полного приложения `spectr_utmc_cpp` в режиме работы с реальным контроллером и Spectr-ITS сервером

---

## Статус предыдущих этапов

- ✅ Этап 1-2: Основные GET операции
- ✅ Этап 3: Дополнительные GET операции
- ✅ Этап 4: Тестирование приема traps
- ✅ Этап 5: Проверка кода SET операций
- ✅ Этап 6: Тестирование SET операций (кроме ЖМ, которое требует дополнительного исследования)

---

## Этап 7: Интеграционное тестирование

### Шаг 7.1: Подготовка конфигурации

**Цель:** Подготовить конфигурацию для тестирования с реальным контроллером

**Действия:**
1. Проверить наличие `config.json` с правильными настройками
2. Убедиться, что адрес контроллера указан правильно (192.168.75.150)
3. Проверить настройки подключения к Spectr-ITS серверу

**Проверка:**
- Конфигурация должна содержать правильный IP контроллера
- Community должен быть "UTMC"
- Настройки Spectr-ITS должны быть корректными

---

### Шаг 7.2: Компиляция и сборка приложения

**Цель:** Убедиться, что приложение собирается без ошибок

**Действия:**
```bash
cd /home/alexey/shared_vm/spectr_utmc/spectr_utmc/spectr_utmc_cpp
mkdir -p build
cd build
cmake ..
make
```

**Проверка:**
- Компиляция должна пройти без ошибок
- Должен быть создан исполняемый файл `spectr_utmc_cpp`

---

### Шаг 7.3: Тестирование запуска приложения

**Цель:** Проверить, что приложение запускается и инициализируется корректно

**Действия:**
1. Запустить приложение с конфигурацией
2. Проверить вывод на наличие ошибок
3. Проверить создание SNMP сессий для контроллеров

**Команда:**
```bash
./build/spectr_utmc_cpp config.json
```

**Ожидаемый результат:**
- Приложение запускается без ошибок
- Создаются SNMP сессии для всех контроллеров из config.json
- Приложение ожидает подключения к Spectr-ITS серверу

**Проверка:**
- Нет ошибок при запуске
- SNMP сессии созданы успешно
- TCP клиент пытается подключиться к Spectr-ITS серверу

---

### Шаг 7.4: Тестирование подключения к Spectr-ITS серверу

**Цель:** Проверить подключение к Spectr-ITS серверу

**Действия:**
1. Запустить приложение
2. Проверить попытку подключения к серверу
3. Проверить обработку успешного подключения или ошибок подключения

**Ожидаемый результат:**
- Приложение пытается подключиться к Spectr-ITS серверу
- При успешном подключении - соединение установлено
- При ошибке подключения - попытки переподключения согласно настройкам

**Проверка:**
- Логи показывают попытки подключения
- Обработка успешного подключения
- Обработка ошибок подключения

---

### Шаг 7.5: Тестирование обработки команд от Spectr-ITS

**Цель:** Проверить обработку команд от Spectr-ITS сервера

**Действия:**
1. Запустить приложение
2. Подключиться к Spectr-ITS серверу (или использовать тестовый сервер)
3. Отправить команду SET_PHASE
4. Проверить выполнение команды на контроллере

**Тестовые команды:**
- `SET_PHASE <requestId> <phase>` - установка фазы
- `SET_YF <requestId>` - включение желтого мигания
- `SET_OS <requestId>` - выключение контроллера
- `SET_LOCAL <requestId>` - возврат в локальный режим
- `GET_STAT <requestId>` - получение статистики

**Ожидаемый результат:**
- Команды принимаются от сервера
- Команды выполняются на контроллере через SNMP
- Результаты отправляются обратно на сервер

**Проверка:**
- Команды обрабатываются корректно
- SNMP операции выполняются успешно
- Ответы отправляются на сервер

---

### Шаг 7.6: Тестирование отправки событий на Spectr-ITS

**Цель:** Проверить отправку событий от контроллера на сервер

**Действия:**
1. Запустить приложение
2. Подключиться к серверу
3. Дождаться событий от контроллера (traps или изменения состояния)
4. Проверить отправку событий на сервер

**Ожидаемые события:**
- Изменение фазы (event type 4)
- Изменение режима управления (event type 3)
- Traps от контроллера

**Ожидаемый результат:**
- События отправляются на сервер
- Формат событий соответствует протоколу Spectr-ITS
- События содержат правильные данные

**Проверка:**
- События отправляются корректно
- Формат данных правильный
- Данные соответствуют состоянию контроллера

---

### Шаг 7.7: Тестирование обработки traps

**Цель:** Проверить обработку SNMP traps от контроллера

**Действия:**
1. Запустить приложение
2. Настроить контроллер на отправку traps (если возможно)
3. Дождаться traps от контроллера
4. Проверить обработку traps и отправку событий на сервер

**Ожидаемый результат:**
- Traps принимаются от контроллера
- Traps обрабатываются корректно
- События отправляются на сервер на основе traps

**Проверка:**
- Traps принимаются успешно
- Данные из traps обрабатываются правильно
- События формируются корректно

---

### Шаг 7.8: Тестирование переподключений

**Цель:** Проверить обработку разрывов соединения и переподключений

**Действия:**
1. Запустить приложение
2. Подключиться к серверу
3. Разорвать соединение (закрыть сервер или сеть)
4. Проверить попытки переподключения
5. Восстановить соединение
6. Проверить восстановление работы

**Ожидаемый результат:**
- При разрыве соединения приложение обнаруживает ошибку
- Приложение пытается переподключиться согласно настройкам (reconnectTimeout)
- При восстановлении соединения работа продолжается

**Проверка:**
- Ошибки соединения обрабатываются корректно
- Переподключения выполняются согласно настройкам
- После переподключения работа восстанавливается

---

### Шаг 7.9: Тестирование обработки ошибок SNMP

**Цель:** Проверить обработку ошибок SNMP операций

**Действия:**
1. Запустить приложение
2. Попытаться выполнить операцию с неверным OID или параметрами
3. Проверить обработку ошибок
4. Проверить отправку ошибок на сервер

**Ожидаемый результат:**
- Ошибки SNMP обрабатываются корректно
- Ошибки отправляются на сервер в правильном формате
- Приложение продолжает работу после ошибок

**Проверка:**
- Ошибки обрабатываются без падений
- Формат ошибок соответствует протоколу
- Приложение стабильно работает

---

### Шаг 7.10: Тестирование полного цикла работы

**Цель:** Проверить полный цикл работы приложения

**Действия:**
1. Запустить приложение
2. Подключиться к серверу
3. Выполнить последовательность команд:
   - GET_STAT - получить статистику
   - SET_PHASE - установить фазу
   - Дождаться события об изменении фазы
   - SET_LOCAL - вернуть в локальный режим
4. Проверить корректность всех операций

**Ожидаемый результат:**
- Все команды выполняются успешно
- События отправляются корректно
- Приложение работает стабильно

**Проверка:**
- Полный цикл работает без ошибок
- Все операции выполняются корректно
- Данные синхронизированы между контроллером и сервером

---

## Критерии успешного завершения этапа

1. ✅ Приложение запускается без ошибок
2. ✅ Подключение к Spectr-ITS серверу работает
3. ✅ Команды от сервера обрабатываются корректно
4. ✅ События отправляются на сервер
5. ✅ Traps обрабатываются корректно
6. ✅ Переподключения работают
7. ✅ Ошибки обрабатываются без падений
8. ✅ Полный цикл работы функционирует

---

## Следующие шаги после этапа 7

1. Нагрузочное тестирование
2. Тестирование в production-подобной среде
3. Документирование результатов
4. Подготовка к развертыванию
