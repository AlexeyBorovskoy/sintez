# План тестирования с использованием TUI приложения

**Дата:** 2026-02-03  
**Контроллер:** 192.168.75.150  
**Особенность:** Возможность изменения режимов/параметров через TUI приложение

---

## ⚠️ ВАЖНО: Безопасность тестирования

**Новый подход:** Использование TUI приложения для изменения параметров контроллера позволяет:
- Безопасно тестировать GET операции при разных режимах
- Проверять реакцию нашего кода на изменения контроллера
- Тестировать SET операции с возможностью отката через TUI

---

## Этап 1: Базовые GET операции (БЕЗОПАСНО) ✅ ЗАВЕРШЕН

### Результаты:
- ✅ sysUpTime - работает
- ✅ Application Version - работает (1.4.20)
- ✅ Operation Mode - работает (1 = Standalone)
- ✅ Controller Time - работает

---

## Этап 2: Дополнительные GET операции (БЕЗОПАСНО) ✅ ЗАВЕРШЕН

### Результаты:
- ✅ GetPhase - работает (Hex-STRING: 02 00)
- ✅ GetError - работает (0 = нет ошибок)
- ✅ GetWarnings - работает (0 = нет предупреждений)
- ✅ GetRCP - работает (0 = панель не активна)
- ✅ GetAF - работает (0 = ЖМ выключено)
- ⚠️ StageDemandBits - требует SCN (не используется в приложении)

---

## Этап 3: Тестирование при разных режимах работы (БЕЗОПАСНО)

### Шаг 3.1: Проверка текущего режима
- **Действие:** Выполнить GET запрос для Operation Mode
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.4.1`
- **Ожидаемый результат:** Получено текущее значение режима
- **Текущее значение:** 1 (Standalone)
- **Безопасность:** ✅ Только чтение

### Шаг 3.2: Изменение режима через TUI (пользователь)
- **Действие:** Пользователь меняет режим контроллера через TUI приложение
- **Варианты:**
  - Standalone (1) → Monitor (2)
  - Standalone (1) → UTC Control (3)
  - Monitor (2) → UTC Control (3)
- **Проверка:** После изменения проверить через GET запрос

### Шаг 3.3: Проверка изменения режима через GET
- **Действие:** Выполнить GET запрос для Operation Mode после изменения через TUI
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.4.1`
- **Ожидаемый результат:** Получено новое значение режима (соответствует изменению через TUI)
- **Безопасность:** ✅ Только чтение, проверка реакции на изменения

### Шаг 3.4: Проверка других параметров при изменении режима
- **Действие:** Проверить, как изменились другие параметры при смене режима
- **Проверяемые параметры:**
  - GetPhase (текущая фаза)
  - GetError (ошибки)
  - GetWarnings (предупреждения)
  - GetRCP (панель внешнего управления)
  - GetAF (желтое мигание)
- **Безопасность:** ✅ Только чтение

---

## Этап 4: Тестирование приема SNMP traps при разных режимах (БЕЗОПАСНО)

### Шаг 4.1: Запуск приемника traps в режиме Standalone
- **Действие:** Запустить приемник traps
- **Команда:** `./build/test_controller traps 10162 UTMC`
- **Ожидаемый результат:** Traps не получены (нормально для Standalone)
- **Безопасность:** ✅ Только прием данных

### Шаг 4.2: Изменение режима на Monitor через TUI (пользователь)
- **Действие:** Пользователь меняет режим на Monitor (2) через TUI
- **Проверка:** Подтвердить изменение через GET запрос

### Шаг 4.3: Запуск приемника traps в режиме Monitor
- **Действие:** Запустить приемник traps после изменения режима
- **Команда:** `./build/test_controller traps 10162 UTMC`
- **Ожидаемый результат:** Возможно получение traps (в режиме Monitor контроллер может отправлять traps)
- **Безопасность:** ✅ Только прием данных

### Шаг 4.4: Изменение режима на UTC Control через TUI (пользователь)
- **Действие:** Пользователь меняет режим на UTC Control (3) через TUI
- **Проверка:** Подтвердить изменение через GET запрос

### Шаг 4.5: Запуск приемника traps в режиме UTC Control
- **Действие:** Запустить приемник traps после изменения режима
- **Команда:** `./build/test_controller traps 10162 UTMC`
- **Ожидаемый результат:** Возможно получение traps (в режиме UTC Control контроллер активно отправляет traps)
- **Безопасность:** ✅ Только прием данных

---

## Этап 5: Тестирование SET операций с откатом через TUI (ОТНОСИТЕЛЬНО БЕЗОПАСНО)

**⚠️ ВАЖНО:** Все SET операции выполняются с возможностью отката через TUI приложение

### Шаг 5.1: Подготовка к тестированию SET операций
- **Действие:** Зафиксировать текущее состояние контроллера
- **Проверка:**
  - Текущий режим работы (Operation Mode)
  - Текущая фаза (GetPhase)
  - Состояние ЖМ (GetAF)
  - Все остальные параметры
- **Безопасность:** ✅ Только чтение

### Шаг 5.2: Тестирование SET Operation Mode (с откатом через TUI)
- **Действие:** Попытка установить режим работы через SET
- **Текущий режим:** (зафиксировать перед тестом)
- **Новый режим:** (выбрать допустимый: можно только увеличивать 1→2→3)
- **Команда:** (будет создана тестовая утилита для SET)
- **Проверка:** После SET проверить через GET запрос
- **Откат:** Если нужно, пользователь откатывает через TUI
- **⚠️ ОПАСНОСТЬ:** Может изменить режим работы контроллера
- **Безопасность:** ⚠️ Изменяет состояние, но есть возможность отката через TUI

### Шаг 5.3: Тестирование SET Phase (с откатом через TUI)
- **Действие:** Попытка установить фазу через SET
- **Условие:** Контроллер должен быть в режиме UTC Control (3)
- **Текущая фаза:** (зафиксировать перед тестом)
- **Новая фаза:** (выбрать допустимую)
- **Команда:** (будет создана тестовая утилита для SET)
- **Проверка:** После SET проверить через GET запрос
- **Откат:** Если нужно, пользователь откатывает через TUI
- **⚠️ ОПАСНОСТЬ:** Может изменить текущую фазу светофора
- **Безопасность:** ⚠️ Изменяет состояние, но есть возможность отката через TUI

### Шаг 5.4: Тестирование SET AF (ЖМ) (с откатом через TUI)
- **Действие:** Попытка включить желтое мигание через SET
- **Текущее состояние:** (зафиксировать перед тестом)
- **Команда:** (будет создана тестовая утилита для SET)
- **Проверка:** После SET проверить через GET запрос
- **Откат:** Если нужно, пользователь откатывает через TUI
- **⚠️ ОПАСНОСТЬ:** Может включить желтое мигание на светофоре
- **Безопасность:** ⚠️ Изменяет состояние, но есть возможность отката через TUI

---

## Этап 6: Интеграционное тестирование (БЕЗОПАСНО)

### Шаг 6.1: Тестирование полного цикла работы приложения
- **Действие:** Запустить основное приложение `spectr_utmc_cpp`
- **Проверка:** 
  - Подключение к контроллеру
  - Чтение данных
  - Обработка traps (если есть)
- **Безопасность:** ✅ Только чтение и прием данных

### Шаг 6.2: Тестирование при разных режимах контроллера
- **Действие:** Изменять режим контроллера через TUI и проверять работу приложения
- **Режимы:**
  - Standalone (1)
  - Monitor (2)
  - UTC Control (3)
- **Проверка:** Приложение должно корректно работать во всех режимах
- **Безопасность:** ✅ Только чтение и прием данных

---

## Рекомендуемый порядок выполнения

1. **Этап 3** (Шаги 3.1-3.4) - Тестирование при разных режимах через TUI ✅ Безопасно
2. **Этап 4** (Шаги 4.1-4.5) - Тестирование traps при разных режимах ✅ Безопасно
3. **Этап 5** (Шаги 5.1-5.4) - Тестирование SET операций с откатом ⚠️ Относительно безопасно
4. **Этап 6** (Шаги 6.1-6.2) - Интеграционное тестирование ✅ Безопасно

---

## Преимущества нового подхода

1. **Безопасность:**
   - Все изменения можно откатить через TUI
   - Можно тестировать SET операции с контролем
   - Можно проверить реакцию на изменения контроллера

2. **Полнота тестирования:**
   - Тестирование при разных режимах работы
   - Проверка работы traps в разных режимах
   - Проверка SET операций с реальными изменениями

3. **Контроль:**
   - Пользователь контролирует изменения через TUI
   - Можно быстро откатить нежелательные изменения
   - Можно проверить корректность работы приложения

---

## Следующие шаги

1. Создать тестовую утилиту для SET операций
2. Начать с Этапа 3 - тестирование при разных режимах через TUI
3. Постепенно переходить к более сложным тестам
