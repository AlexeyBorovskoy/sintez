# Следующие шаги тестирования

**Текущий статус:** ✅ Все GET операции чтения данных работают успешно  
**Дата:** 2026-02-03  
**Контроллер:** 192.168.75.150

---

## ⚠️ ВАЖНО: Безопасность тестирования

**Правило:** Все операции, которые могут изменить состояние контроллера или повлиять на его работу, выполняются ТОЛЬКО в последнюю очередь и с особой осторожностью.

---

## Этап 3: Дополнительные GET операции (БЕЗОПАСНО)

### Шаг 3.1: Получение текущей фазы (GetPhase)
- **Действие:** Выполнить GET запрос для получения текущего номера фазы
- **OID:** `1.3.6.1.4.1.13267.3.2.5.1.1.3`
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.5.1.1.3`
- **Ожидаемый результат:** Получено значение текущей фазы (число)
- **Безопасность:** ✅ Только чтение, не изменяет состояние контроллера
- **Проверка:** Зафиксировать полученное значение

### Шаг 3.2: Получение ошибок (GetError)
- **Действие:** Выполнить GET запрос для получения ошибок контроллера
- **OID:** `1.3.6.1.4.1.13267.3.2.5.1.1.5`
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.5.1.1.5`
- **Ожидаемый результат:** Получено значение ошибок (0 = нет ошибок, 1 = есть ошибки)
- **Безопасность:** ✅ Только чтение, не изменяет состояние контроллера
- **Проверка:** Зафиксировать полученное значение

### Шаг 3.3: Получение предупреждений (GetWarnings)
- **Действие:** Выполнить GET запрос для получения предупреждений контроллера
- **OID:** `1.3.6.1.4.1.13267.3.2.5.1.1.16`
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.5.1.1.16`
- **Ожидаемый результат:** Получено значение предупреждений (0 = нет предупреждений, 1 = есть предупреждения)
- **Безопасность:** ✅ Только чтение, не изменяет состояние контроллера
- **Проверка:** Зафиксировать полученное значение

### Шаг 3.4: Получение состояния панели внешнего управления (GetRCP)
- **Действие:** Выполнить GET запрос для получения состояния панели внешнего управления
- **OID:** `1.3.6.1.4.1.13267.3.2.5.1.1.15`
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.5.1.1.15`
- **Ожидаемый результат:** Получено значение состояния панели (0 или 1)
- **Безопасность:** ✅ Только чтение, не изменяет состояние контроллера
- **Проверка:** Зафиксировать полученное значение

### Шаг 3.5: Получение состояния ЖМ (GetAF - желтое мигание)
- **Действие:** Выполнить GET запрос для получения состояния желтого мигания
- **OID:** `1.3.6.1.4.1.13267.3.2.5.1.1.36`
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.5.1.1.36`
- **Ожидаемый результат:** Получено значение состояния ЖМ (0 или 1)
- **Безопасность:** ✅ Только чтение, не изменяет состояние контроллера
- **Проверка:** Зафиксировать полученное значение

### Шаг 3.6: Получение StageDemandBits (текущая фаза в формате битов)
- **Действие:** Выполнить GET запрос для получения текущей фазы в формате битов
- **OID:** `1.3.6.1.4.1.13267.3.2.4.2.1.4`
- **Команда:** `./build/test_controller get 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.4.2.1.4`
- **Ожидаемый результат:** Получено значение битовой маски текущей фазы
- **Безопасность:** ✅ Только чтение, не изменяет состояние контроллера
- **Проверка:** Зафиксировать полученное значение

---

## Этап 4: Тестирование приема SNMP traps (БЕЗОПАСНО)

### Шаг 4.1: Запуск приемника traps
- **Действие:** Запустить приемник SNMP traps на порту 10162
- **Команда:** `./build/test_controller traps 10162 UTMC`
- **Ожидаемый результат:** Приемник запущен и ожидает traps
- **Безопасность:** ✅ Только прием данных, не изменяет состояние контроллера
- **Проверка:** Убедиться, что приемник запустился без ошибок
- **Примечание:** Может потребоваться ожидание, если контроллер не отправляет traps активно

### Шаг 4.2: Ожидание traps (если контроллер их отправляет)
- **Действие:** Подождать некоторое время (30-60 секунд) для получения traps
- **Ожидаемый результат:** Получены traps от контроллера (если он их отправляет)
- **Безопасность:** ✅ Только прием данных, не изменяет состояние контроллера
- **Проверка:** Зафиксировать полученные traps (если есть)
- **Примечание:** Если traps не получены - это нормально, контроллер может не отправлять их активно

### Шаг 4.3: Анализ полученных traps
- **Действие:** Проанализировать структуру полученных traps
- **Проверка:** 
  - Формат данных
  - OID в traps
  - Значения varbinds
- **Безопасность:** ✅ Только анализ данных, не изменяет состояние контроллера

---

## Этап 5: Проверка кода SET операций (БЕЗ ВЫПОЛНЕНИЯ)

### Шаг 5.1: Проверка реализации SET операций в коде
- **Действие:** Проверить код SET операций в `src/snmp_handler.cpp` и `src/object_manager.cpp`
- **Проверка:**
  - Правильность формирования PDU для SET
  - Правильность OID (без `.0` для этого контроллера)
  - Обработка ошибок
- **Безопасность:** ✅ Только проверка кода, не выполняется на контроллере

### Шаг 5.2: Проверка соответствия с исходным Node.js проектом
- **Действие:** Сравнить логику SET операций с исходным Node.js кодом
- **Проверка:**
  - Соответствие OID
  - Соответствие формата данных
  - Соответствие последовательности операций
- **Безопасность:** ✅ Только сравнение кода, не выполняется на контроллере

---

## Этап 6: Тестирование SET операций (⚠️ ОПАСНО - ВЫПОЛНЯТЬ С ОСТОРОЖНОСТЬЮ)

**⚠️ ВНИМАНИЕ:** Все SET операции изменяют состояние контроллера и могут повлиять на его работу!  
**⚠️ Выполнять ТОЛЬКО после согласования и с возможностью быстрого отката!**

### Шаг 6.1: Подготовка к тестированию SET операций
- **Действие:** Зафиксировать текущее состояние контроллера
- **Проверка:**
  - Записать текущий режим работы (Operation Mode)
  - Записать текущую фазу (GetPhase)
  - Записать состояние ЖМ (GetAF)
- **Безопасность:** ✅ Только чтение текущего состояния
- **Важно:** Эти данные нужны для отката изменений

### Шаг 6.2: Тестирование SET Operation Mode (⚠️ ОПАСНО)
- **Действие:** Попытка установить режим работы (только если текущий режим позволяет)
- **OID:** `1.3.6.1.4.1.13267.3.2.4.1`
- **Значение:** Зависит от текущего режима (можно только увеличивать: 1→2→3)
- **⚠️ ОПАСНОСТЬ:** Может изменить режим работы контроллера
- **Рекомендация:** Пропустить на данном этапе или выполнять только с разрешения

### Шаг 6.3: Тестирование SET Phase (⚠️ ОПАСНО)
- **Действие:** Попытка установить фазу (только если контроллер в режиме UTC Control)
- **OID:** `1.3.6.1.4.1.13267.3.2.4.2.1.5`
- **⚠️ ОПАСНОСТЬ:** Может изменить текущую фазу светофора
- **Рекомендация:** Пропустить на данном этапе или выполнять только с разрешения

### Шаг 6.4: Тестирование SET PhaseTrue (⚠️ ОПАСНО)
- **Действие:** Попытка разрешить установку фазы
- **OID:** `1.3.6.1.4.1.13267.3.2.4.2.1.15`
- **⚠️ ОПАСНОСТЬ:** Может разрешить изменение фаз
- **Рекомендация:** Пропустить на данном этапе или выполнять только с разрешения

### Шаг 6.5: Тестирование SET AF (ЖМ) (⚠️ ОПАСНО)
- **Действие:** Попытка включить желтое мигание
- **OID:** `1.3.6.1.4.1.13267.3.2.4.2.1.20`
- **⚠️ ОПАСНОСТЬ:** Может включить желтое мигание на светофоре
- **Рекомендация:** Пропустить на данном этапе или выполнять только с разрешения

### Шаг 6.6: Тестирование SET OFF (⚠️ ОПАСНО)
- **Действие:** Попытка выключить контроллер
- **OID:** (уточнить из документации)
- **⚠️ ОПАСНОСТЬ:** Может выключить контроллер
- **Рекомендация:** Пропустить на данном этапе или выполнять только с разрешения

---

## Рекомендуемый порядок выполнения

1. **Этап 3** (Шаги 3.1-3.6) - Дополнительные GET операции ✅ Безопасно
2. **Этап 4** (Шаги 4.1-4.3) - Тестирование приема traps ✅ Безопасно
3. **Этап 5** (Шаги 5.1-5.2) - Проверка кода SET операций ✅ Безопасно
4. **Этап 6** (Шаги 6.1-6.6) - Тестирование SET операций ⚠️ ОПАСНО - выполнять в последнюю очередь

---

## Примечания

1. **Все SET операции** должны выполняться только после:
   - Полного тестирования всех GET операций
   - Тестирования приема traps
   - Проверки кода SET операций
   - Согласования с ответственным лицом

2. **Перед каждой SET операцией:**
   - Зафиксировать текущее состояние контроллера
   - Убедиться, что есть возможность отката изменений
   - Выполнять по одной операции с проверкой результата

3. **Если SET операция изменила состояние контроллера:**
   - Немедленно проверить результат
   - При необходимости выполнить откат к исходному состоянию
   - Зафиксировать результаты в документации

---

## Следующие шаги (после завершения тестирования)

1. Интеграционное тестирование с Spectr-ITS протоколом
2. Тестирование полного цикла работы приложения
3. Тестирование обработки ошибок и переподключений
4. Нагрузочное тестирование
