# Проблема с включением желтого мигания (ЖМ)

**Дата:** 2026-02-03  
**Контроллер:** 192.168.75.150  
**Проблема:** Желтое мигание не включается визуально, несмотря на успешные SET операции

---

## Выполненные операции

### 1. Одиночный SET FF=1
```bash
./build/test_controller set 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.4.2.1.20 2 1
```
**Результат:** ✅ SET выполнен успешно, но ЖМ не включилось

### 2. Последовательные SET (режим + FF)
```bash
./build/test_controller set 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.4.1 2 3
./build/test_controller set 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.4.2.1.20 2 1
```
**Результат:** ✅ Оба SET выполнены успешно, но ЖМ не включилось

### 3. Множественный SET (одновременно режим + FF)
```bash
./build/test_controller setmulti 192.168.75.150 UTMC 1.3.6.1.4.1.13267.3.2.4.1 2 3 1.3.6.1.4.1.13267.3.2.4.2.1.20 2 1
```
**Результат:** ✅ SET выполнен успешно (оба параметра установлены), но ЖМ не включилось

---

## Проверка состояния

### GET Operation Mode
- **OID:** `1.3.6.1.4.1.13267.3.2.4.1`
- **Значение:** `INTEGER: 3` (UTC Control) ✅

### GET FF (UTC_CONTROL_FF)
- **OID:** `1.3.6.1.4.1.13267.3.2.4.2.1.20`
- **Значение:** `INTEGER: 1` ✅

### GET AF (состояние ЖМ)
- **OID:** `1.3.6.1.4.1.13267.3.2.5.1.1.36` (UTC_REPLY_FR)
- **Значение:** `INTEGER: 0` ❌ (должно быть 1)

---

## Анализ проблемы

### Возможные причины:

1. **Контроллер требует дополнительных условий:**
   - Может быть, нужна определенная фаза перед включением ЖМ
   - Может быть, контроллер должен быть в определенном состоянии
   - Может быть, требуется установка других параметров

2. **Задержка в контроллере:**
   - Контроллер может применять изменения с задержкой
   - Может потребоваться время для перехода в режим ЖМ

3. **Неправильный OID для проверки:**
   - OID `1.3.6.1.4.1.13267.3.2.5.1.1.36` может не отражать реальное состояние ЖМ
   - Может быть другой OID для проверки состояния

4. **Ограничения контроллера:**
   - Контроллер может не поддерживать включение ЖМ через SNMP в текущем режиме
   - Может требоваться специальная настройка контроллера

5. **Проблема с множественными SET:**
   - Хотя SET выполнен успешно, контроллер может требовать определенный порядок установки параметров
   - Может быть, нужно установить параметры в определенной последовательности

---

## Сравнение с исходным кодом

### Код `setYF` в `object_manager.cpp`:
```cpp
SNMPVarbind modeVarbind;
modeVarbind.oid = SNMPOID::UTC_TYPE2_OPERATION_MODE;
modeVarbind.type = ASN_INTEGER;
modeVarbind.value = "3";
varbinds.push_back(modeVarbind);

SNMPVarbind ffVarbind;
ffVarbind.oid = SNMPOID::UTC_CONTROL_FF;
ffVarbind.type = ASN_INTEGER;
ffVarbind.value = "1";
varbinds.push_back(ffVarbind);
```

**Вывод:** Код соответствует тому, что мы делаем - устанавливаем режим UTC Control (3) и FF=1 одновременно.

---

## Рекомендации для дальнейшего исследования

1. **Проверить документацию контроллера:**
   - Уточнить требования для включения ЖМ
   - Проверить, нужны ли дополнительные параметры

2. **Проверить другие OID:**
   - Поискать другие OID, связанные с ЖМ
   - Проверить, может быть есть OID для проверки состояния FF

3. **Проверить последовательность операций:**
   - Попробовать установить фазу перед включением ЖМ
   - Попробовать другие комбинации параметров

4. **Проверить через веб-интерфейс:**
   - Включить ЖМ через веб-интерфейс
   - Проверить, какие параметры изменяются при включении ЖМ через веб-интерфейс

5. **Проверить логи контроллера:**
   - Посмотреть логи контроллера при попытке включения ЖМ
   - Проверить, есть ли ошибки или предупреждения

---

## Статус

⚠️ **Проблема не решена**

- SET операции выполняются успешно
- Параметры устанавливаются корректно
- Но ЖМ не включается визуально
- GET запрос показывает, что состояние ЖМ = 0

**Требуется дальнейшее исследование.**
