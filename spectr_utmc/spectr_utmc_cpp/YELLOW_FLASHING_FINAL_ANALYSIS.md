# Финальный анализ проблемы с жёлтым миганием

**Дата:** 2026-02-04  
**Статус:** Команды выполняются успешно, но визуально мигание не активируется

---

## Текущая ситуация

### Что работает:
- ✅ SNMP команды выполняются успешно (режим меняется на UTC Control)
- ✅ Команда SET_YF отправляется успешно (через локальный SNMP 127.0.0.1)
- ✅ Удалённое управление разрешено в настройках
- ✅ Протокол UTMC настроен

### Что не работает:
- ❌ Визуально жёлтое мигание НЕ активируется
- ❌ Контроллер продолжает работать по заложенной программе

---

## Важные наблюдения

### 1. Команды от локального источника работают

**Тест через SSH на контроллере:**
```bash
snmpset -v2c -c UTMC 127.0.0.1 \
    1.3.6.1.4.1.13267.3.2.4.1 i 3 \
    1.3.6.1.4.1.13267.3.2.4.2.1.20 i 1
```

**Результат:**
```
iso.3.6.1.4.1.13267.3.2.4.1 = INTEGER: 3
iso.3.6.1.4.1.13267.3.2.4.2.1.20 = INTEGER: 1
```

✅ Команда выполнена успешно, но визуально мигание не активировалось.

### 2. Режим ЖМ не должен отключаться автоматически

**Важное замечание пользователя:**
> "Режим ЖМ не должен отключаться автоматически, должна последовать команда на переход на другую программу управления"

**Вывод:** Логика автоматического отключения через 60 секунд **неправильная**. Режим ЖМ должен оставаться активным до явной команды перехода на другую программу.

---

## Возможные причины проблемы

### Причина 1: Требуется другая последовательность команд

**Гипотеза:** Команда SET_YF требует предварительной установки фазы или других условий.

**Проверка:** Попробовать последовательность:
1. Установить режим UTC Control (3)
2. Установить специальную фазу (фаза 1)
3. Дождаться минимального периода работы фазы
4. Активировать мигание (SET_YF)

### Причина 2: Команды должны приходить через spectr_utmc.js

**Гипотеза:** Контроллер принимает команды SET_YF только через `spectr_utmc.js` на контроллере, а не напрямую через SNMP.

**Проверка:** Отправить команду SET_YF через протокол Spectr-ITS на `spectr_utmc.js` на контроллере.

### Причина 3: Требуются дополнительные условия

**Гипотеза:** Контроллер требует выполнения дополнительных условий для активации мигания:
- Определённый режим работы (не "Фиксированный")
- Отсутствие переходных процессов
- Другие условия из конфигурации

---

## Рекомендуемые действия

### Действие 1: Проверить работу через spectr_utmc.js на контроллере

Подключиться к контроллеру по SSH и отправить команду SET_YF через `spectr_utmc.js`:

```bash
ssh voicelink@192.168.75.150
# На контроллере найти способ отправки команды через spectr_utmc.js
# Или проверить, как АСУДД отправляет команды
```

### Действие 2: Проверить логи контроллера

Проверить логи `resident` или `snmp_agent` на наличие ошибок или блокировок при получении команды SET_YF:

```bash
ssh voicelink@192.168.75.150
# Проверить логи resident или snmp_agent
# Найти сообщения об ошибках или блокировках
```

### Действие 3: Проверить конфигурацию контроллера

Проверить конфигурацию контроллера на наличие настроек, которые могут блокировать активацию мигания:

```bash
ssh voicelink@192.168.75.150
# Проверить конфигурацию resident
# Найти настройки, связанные с миганием
```

---

## Вывод

**Основная проблема:** Команды SET_YF выполняются успешно, но визуально мигание не активируется.

**Возможные причины:**
1. Требуется другая последовательность команд
2. Команды должны приходить через `spectr_utmc.js` на контроллере
3. Требуются дополнительные условия для активации

**Следующие шаги:**
1. Проверить, как именно работает команда SET_YF в реальной АСУДД системе
2. Проверить логи контроллера на наличие ошибок
3. Проверить конфигурацию контроллера на наличие блокировок

**Важно:** Режим ЖМ не должен отключаться автоматически - нужна команда для перехода на другую программу управления.
