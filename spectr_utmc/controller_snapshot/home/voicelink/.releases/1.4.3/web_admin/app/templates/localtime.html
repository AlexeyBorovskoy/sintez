<!-- extend base layout -->
{% extends "base.html" %}

{% block javascript %}
<script type="text/javascript">
function loadDateTime() {
  var timezone = document.getElementsByName("timezone")[0];
  var date = document.getElementsByName("date")[0];
  var time = document.getElementsByName("time")[0];

  function setLocalDateTime(event) { // при надажии t устанавливает локальное время компа
    var kep = event.which;
    if (kep == 84) { //84 - код клавиши t
      // текущая дата
      var datec = new Date();
      var hours = datec.getHours();
      var minutes = datec.getMinutes();
      var seconds = datec.getSeconds();
      var dt = datec.getDate();
      var month = datec.getMonth()+1;
      var year = datec.getFullYear();
      
      timezone.value = -1*datec.getTimezoneOffset()/60;
      
      if (dt < 10)
        dt2display = "0" + dt;
      else
        dt2display = dt;
      if (month < 10)
        month2display = "0" + month;
      else
        month2display = month;
      date.value = dt2display+"."+month2display+"."+year;
      
      if (hours < 10)
        hours2display = "0" + hours;
      else
        hours2display = hours;
      if (minutes < 10)
        minutes2display = "0" + minutes;
      else
        minutes2display = minutes;
      if (seconds < 10)
        seconds2display = "0" + seconds;
      else
        seconds2display = seconds;
      time.value = hours2display + ":" + minutes2display + ":" + seconds2display;
    }
  };
  document.body.onkeydown = setLocalDateTime;
};
</script>
{% endblock %}

{% block start_javascript %}
<body class="gray-bg" onLoad="loadDateTime();">
{% endblock %}

{% block content %}
<form class="form-horizontal" method="post" name="localtime" action="">
<h3>{{ _('Setting the date and time.') }}</h3>
{{form.hidden_tag()}}
  <div class="form-group">
    <label class="control-label col-sm-2">{{ _('Time zone:') }}</label>
    <div class="col-sm-10">
      <select class="form-control" name="timezone">
        {% for tz in time.get("timezones", range(-12, 15, 1)) %}
        <option value="{{ tz }}" {% if time.timezone == tz %} selected="selected" {% endif %}>UTC{% if tz > 0 %}+{{tz}}{% elif tz < 0 %}{{tz}}{% endif %}</option>
        {% endfor %}
      </select>
    </div>
  </div>
  <div class="form-group">
    <label class="control-label col-sm-2">{{ _('Date:') }}</label>
    <div class="col-sm-10">
      <input required pattern="(((0[1-9]|[12]\d|3[01])[- /.](0[13578]|1[02])[- /.](20\d{2}))|((0[1-9]|[12]\d|30)[- /.](0[13456789]|1[012])[- /.](20\d{2}))|((0[1-9]|1\d|2[0-8])[- /.]02[- /.](20\d{2}))|(29[- /.]02[- /.]((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))))" type="text" name="date" value="{{time.date}}" class="form-control" placeholder="{{ _('DD.MM.YYYY-day.month.year') }}">
    </div>
  </div>
  <div class="form-group">
    <label class="control-label col-sm-2">{{ _('Time:') }}</label>
    <div class="col-sm-10">
      <input required pattern="([01]\d|2[0-3]):[0-5][0-9]:[0-5][0-9]" type="text" name="time" value="{{time.time}}" class="form-control" placeholder="{{ _('hh:mm:ss-hours:minutes:seconds') }}">
    </div>
  </div>
  <div class="form-group">
    <!--<div class="col-sm-offset-2 col-sm-10">-->
    <div class="col-sm-12">
      <button type="submit" class="btn btn-custom">{{ _('Save') }}</button>
    </div>
  </div>
</form>
{% endblock %}
